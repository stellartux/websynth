<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: bytebeat-processor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: bytebeat-processor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* BytebeatProcessor runs in the AudioWorkletScope
* @param {object} options
* @param {string} options.processorOptions.beatcode
* Main block of the bytebeat function and its execution
* @param {number} options.processorOptions.frequency
* The frequency at which 't' will be incremented
* @param {number} options.processorOptions.sampleRate
* The sample rate of the audio context
* @param {number} options.processorOptions.tempo
* The tempo which the speed that tt will be incremented depends on
* @param {boolean} [options.processorOptions.floatMode=false]
* Whether the function expects an output between 0:255 (default) or -1:1
*/
class BytebeatProcessor extends AudioWorkletProcessor {
  constructor (options) {
    super(options)
    this.beatcode = new Function('t,tt', options.processorOptions.beatcode)
    this.sampleRate = options.processorOptions.sampleRate
    this.frequency = options.processorOptions.frequency
    this.tDelta = this.frequency / this.sampleRate
    this.t = 0
    this.tt = 0
    this.tempo = options.processorOptions.tempo
    this.ttDelta = this.tempo * 8192 / 120 / this.sampleRate
    this.startTime = Infinity
    this.stopTime = Infinity
    this.port.onmessage = event => {
      switch (event.data.message) {
        case 'stop':
          this.stopTime = currentTime + event.data.stopTime
          break
        case 'start':
          this.startTime = currentTime + event.data.startTime
          break
        default:
      }
    }
    if (options.processorOptions.floatMode) {
      this.postprocess = t => Math.min(1, Math.max(-1, t))
    } else {
      this.postprocess = t => (t % 256) / 128 - 1
    }
  }

  process (inputs, outputs) {
    const output = outputs[0]
    if (currentTime >= this.startTime) {
      for (let i = 0; i &lt; output[0].length; ++i) {
        const data = this.postprocess(
          this.beatcode(Math.floor(this.t), Math.floor(this.tt)))
        for (let channel = 0; channel &lt; output.length; ++channel) {
          output[channel][i] = data
        }
        this.t += this.tDelta
        this.tt += this.ttDelta
      }
    } else {
      for (let channel = 0; channel &lt; output.length; ++channel) {
        for (let i = 0; i &lt; output[channel].length; ++i) {
          output[channel][i] = 0
        }
      }
    }
    return currentTime &lt; this.stopTime
  }
}
registerProcessor('bytebeat-processor', BytebeatProcessor)
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BytebeatNode.html">BytebeatNode</a></li><li><a href="BytebeatNode_.html">BytebeatNode</a></li><li><a href="BytebeatNote.html">BytebeatNote</a></li><li><a href="BytebeatProcessor.html">BytebeatProcessor</a></li><li><a href="Metronome.html">Metronome</a></li><li><a href="MIDINumber.html">MIDINumber</a></li><li><a href="Note.html">Note</a></li><li><a href="NoteMap.html">NoteMap</a></li><li><a href="OscillatorNote.html">OscillatorNote</a></li><li><a href="Preset.html">Preset</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addOscillator">addOscillator</a></li><li><a href="global.html#addPreset">addPreset</a></li><li><a href="global.html#changeCurrentView">changeCurrentView</a></li><li><a href="global.html#getPresetInfo">getPresetInfo</a></li><li><a href="global.html#loadPersistentState">loadPersistentState</a></li><li><a href="global.html#loadPreset">loadPreset</a></li><li><a href="global.html#noteSources">noteSources</a></li><li><a href="global.html#releaseAllNotes">releaseAllNotes</a></li><li><a href="global.html#removePreset">removePreset</a></li><li><a href="global.html#setupControllerListeners">setupControllerListeners</a></li><li><a href="global.html#stopAllSound">stopAllSound</a></li><li><a href="global.html#updateChordDisplay">updateChordDisplay</a></li><li><a href="global.html#updateCustomPresets">updateCustomPresets</a></li><li><a href="global.html#updateEnvelope">updateEnvelope</a></li><li><a href="global.html#updateEnvelopeControls">updateEnvelopeControls</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jan 16 2020 04:13:38 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
